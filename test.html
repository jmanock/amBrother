<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>htmlEmail</title>
</head>
<body>
  <h2 class='content-head is-center'>Contact Us!</h2>
  <aside>
    <p>We would <em>love</em> to hear from you!</p>
    <p>Please use the <b><em>Contact Form</em></b> to send us a message.</p>
  </aside>

  <form id='gform' method='POST' class='pure-form pure-form-stacked' data-email='example@email.net' action=''>
    <fieldset class='pure-group'>
      <label for='name'>Name: </label>
      <input id='name' name='name' placeholder='What your Mom calls you'>
    </fieldset>
    <fieldset class='pure-group'>
      <label for='message'>Message: </label>
      <textarea id='message' name='message'  rows='10'placeholder='Tell us whats on your mind.. '></textarea>
    </fireldset>
    <fieldset class='pure-group'>
      <label for='email' <em>Your</em>Email Address:</label>
      <input id='email' name='email' type='email' value='' required placeholder='your.name@email.com'>
      <span id='email-invalid' style='display:none'>
        Must be a valid email address
      </span>
    </fieldset>
    <fieldset class='pure-group'>
      <label for='color'>Favourite Color:</label>
      <input id='color' name='color' placeholder='green'>
    </fieldset>
    <button class='button-success pure-button-xlarge'>
      <i class='fa fa-paper-plane'></i> &nbsp;Send</button>
    </form>
    <script type="text/javascript">
      function validEmail(email){
        var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
        return re.test(email);
      }
      function validateHuman(honeypot){
        if (honeypot){
          console.log('robot detected!');
          return true;
        }else{
          console.log('welcome human');
        }
      }
      function getFormData(){
        var form = document.getElementById('gform');
        var elements = form.elements;
        var fields = Object.keys(elements).map(function(k){
          if(elements[k].name !== undefined){
            return elements[k].name;
          }else if(elements[k].length > 0){
            return elements[k].item(0).name;
          }
        }).filter(function(item, pos, slef){
          return self.indexOf(item) == pos && item;
        });
        var data = {};
        fields.forEach(function(k){
          data[k] = elements[k].value;
          var str = '';
          if(elements[k].type === 'checkbox'){
            str = str + elelemnts[k].checked + ', ';
            data[k] = str.slice(0, -2);
          }else if(elements[k].length){
            for(var i = 0; i< elements[k].length; i++){
              if(elements[k].item(i).checked){
                str = str + elements[k].item(i).value + ', ';
                data[k] = str.slice(0, -2);
              }
            }
          }
        });
        data.formDataNameOrder = JSON.stringify(fields);
        data.formGoogleSheetName = form.dataset.sheet || 'responses';
        data.formGoogleSendEmail = form.dataset.email || '';
        console.log(data);
        return data;
      }
      function handleFormSubmit(event){
        event.preventDefault();
        var data = getFormData();
        if(!validEmail(data.email)){
          document.getElementById('email-invalid').style.display = 'block';
          return false;
        }else{
          var url = event.target.action;
          var xhr = new XMLHttpRequest();
          xhr.open('POST', url);
          xhr.setRequestHeader('Content-Type', application/x-www-form-urlencoded);
          xhr.onreadystatechange = function(){
            console.log(xhr.status, xhr.statusText);
            console.log(xhr.responseText);
            document.getElementById('gform').style.display = 'none';
            document.getElementById('thankyou_message').style.display = 'block';
            return;
          };
          var encoded = Object.keys(data).map(function(k){
            return encodedURIComponent(k) + '=' + encodeURIComponent(data[k])
          }).join('&');
          xhr.send(encoded);
        }
      }
      function loaded(){
        console.log('contact form submission handler loaded successfully');
        var form = document.getElementById('gform');
        form.addEventListener('submit', handleFormSubmit, false);
      };
      document.addEventListener('DOMContentLoaded', loaded, false);
    </script>
</body>
</html>
